# HTTP知识

1. http客户端发起请求，创建端口，默认为80端口

2. http服务器在端口监听客户端的请求

3. http服务器向客户端返回状态和内容

详细过程（以chrome为例）：

1. chrome搜索自身的DNS缓存（查看chrome自身缓存chrome://net-internals/#dns）

2. 搜索操作系统自身的DNS缓存（浏览器没有找到缓存或者缓存已经失效）

3. 读取本地HOST文件（操作系统也没有DNS缓存）

4. 浏览器发起一个DNS的一个系统调用（host文件也没有找到）

    * 宽带运营商服务器查看本身缓存

    * 运营商服务器发起一个迭代DNS解析的请求（如果自身没有缓存），运营商服务器把结果返回操作系统内核同时缓存起来，然后操作系统内核把结果返回浏览器，最终浏览拿到对应IP地址

5. 浏览器获得域名对应的IP地址后，发起HTTP'三次握手'

    * 第一次握手：建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）

    * 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态

    * 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手

    > 对于一个已经建立的连接，TCP使用改进的三次握手来释放连接（使用一个带有FIN附加标记的报文段）。TCP关闭连接的步骤如下：

    > 第一步，当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FIN附加标记的报文段（FIN表示英文finish）。

    > 第二步，主机B收到这个FIN报文段之后，并不立即用FIN报文段回复主机A，而是先向主机A发送一个确认序号ACK，同时通知自己相应的应用程序：对方要求关闭连接（先发送ACK的目的是为了防止在这段时间内，对方重传FIN报文段）。

    > 第三步，主机B的应用程序告诉TCP：我要彻底的关闭连接，TCP向主机A送一个FIN报文段。

    > 第四步，主机A收到这个FIN报文段后，向主机B发送一个ACK表示连接彻底释放。

6. TCP/IP连接建立起来后，浏览器就可以向服务器发送HTTP请求了，比如说用HTTP的GET方法请求一个根域里的一个域名，协议可以采用HTTP1.0的一个协议

7. 服务器接受到了这个请求，然后根据路径参数，经过后端的一些处理之后，把处理后的一个结果的数据返回给浏览器。

8. 浏览器拿到请求回来的html页面代码，在解析和渲染这个页面的时候，里面的JS、CSS、图片静态资源都是一个个http请求，都需要经过上面的七个步骤。

9. 浏览器根据拿到的资源对页面进行渲染，最终把一个页面呈现给用户

## http头和正文信息

    > 无论请求还是响应都会发送http头和正文信息

    > http头发送的就是一些附加的信息：内容类型、服务器发送响应的日期、http状态码

    > 正文就是用户提交的表单数据

## https

    HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。 它是一个URI scheme（抽象标识符体系），句法类同http:体系。用于安全的HTTP数据传输。https:URL表明它使用了HTTP，但HTTPS存在不同于HTTP的默认端口及一个加密/身份验证层（在HTTP与TCP之间）。